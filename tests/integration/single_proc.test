#!/usr/bin/env tclsh

package require tcltest
package require turtles::test::integration::mt
package require turtles::test::integration::ev
package require turtles::test::integration::postmortem

namespace import ::tcltest::*

set noop_staged_test {
	proc ::noop {} { return }
	noop
	after 200
	update
	test_caller_callee_count stage1 {} {::noop} 1
	return 1
}

set noop_direct_test {
	proc ::noop {} { return }
	noop
	test_caller_callee_count stage0 {} {::noop} 1
	return 1

}

set post_mortem {
	::turtles::test::integration::postmortem::test_caller_callee_counts [list {} {::noop} 1]
}

namespace import ::turtles::test::integration::mt::*

with_turtles macOrUnix "Single proc trace (mt)" staged 100 [subst {$noop_staged_test}] [subst {$post_mortem}]
with_turtles macOrUnix "Single proc trace (mt)" direct 100 [subst {$noop_direct_test}] [subst {$post_mortem}]

namespace forget ::turtles::test::integration::mt::*
namespace import ::turtles::test::integration::ev::*

with_turtles macOrUnix "Single proc trace (ev)" staged 100 [subst {$noop_staged_test}] [subst {$post_mortem}]
with_turtles macOrUnix "Single proc trace (ev)" direct 100 [subst {$noop_direct_test}] [subst {$post_mortem}]


cleanupTests
