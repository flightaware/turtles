#!/usr/bin/env tclsh

package require tcltest
package require turtles::test::integration::mt
package require turtles::test::integration::ev
package require turtles::test::integration::postmortem

namespace import ::tcltest::*

set noop_staged_test {
	proc ::noop {} { return }
	noop
	after 500
	update
	test_caller_callee_count stage1 {} {::noop} 1
	return 1
}

set noop_direct_test {
	proc ::noop {} { return }
	noop
	test_caller_callee_count main {} {::noop} 1
	return 1
}

set post_mortem {
	::turtles::test::integration::postmortem::test_caller_callee_counts [list {} {::noop} 1]
}

namespace import ::turtles::test::integration::mt::*

with_turtles macOrUnix "Single proc trace (mt)" $noop_staged_test $post_mortem "-commitMode staged -intervalMillis 100"
with_turtles macOrUnix "Single proc trace (mt)" $noop_direct_test $post_mortem "-commitMode direct -intervalMillis 100"

namespace forget ::turtles::test::integration::mt::*
namespace import ::turtles::test::integration::ev::*

with_turtles macOrUnix "Single proc trace (ev)" $noop_staged_test $post_mortem "-commitMode staged -intervalMillis 100"
with_turtles macOrUnix "Single proc trace (ev)" $noop_direct_test $post_mortem "-commitMode direct -intervalMillis 100"


cleanupTests
